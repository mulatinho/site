<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head>
    










    







<script defer language="javascript" type="text/javascript" src="/js/bundle.min.145453261a7755f5042a854c4213501d215a8fbe34c08d181c40f803f1315e74.js"></script>






    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">

    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    
    <link rel="icon" href=/favicon.png>

    
    





  





  
  
  


<!-- Open Graph image and Twitter Card metadata -->

<title itemprop="name">Alexandre Mulatinho - DevOps: Ansible Basics</title>
<meta property="og:title" content=Alexandre&#32;Mulatinho&#32;-&#32;DevOps:&#32;Ansible&#32;Basics />
<meta name="twitter:title" content=Alexandre&#32;Mulatinho&#32;-&#32;DevOps:&#32;Ansible&#32;Basics />
<meta itemprop="name" content=Alexandre&#32;Mulatinho&#32;-&#32;DevOps:&#32;Ansible&#32;Basics />
<meta name="application-name" content=Alexandre&#32;Mulatinho&#32;-&#32;DevOps:&#32;Ansible&#32;Basics />
<meta property="og:site_name" content="Alexandre Mulatinho Blog" />


<meta name="description" content="" />
<meta itemprop="description" content="" />
<meta property="og:description" content="" />
<meta name="twitter:description" content="" />


<base href="https://mulatinho.net/2017/01/27/devops-ansible-basics/" />
<link rel="canonical" href="https://mulatinho.net/2017/01/27/devops-ansible-basics/" itemprop="url" />
<meta name="url" content="https://mulatinho.net/2017/01/27/devops-ansible-basics/" />
<meta name="twitter:url" content="https://mulatinho.net/2017/01/27/devops-ansible-basics/" />
<meta property="og:url" content="https://mulatinho.net/2017/01/27/devops-ansible-basics/" />


<meta property="og:updated_time" content="2017-01-27T19:21:01Z" />


<link rel="sitemap" type="application/xml" title="Sitemap" href='https://mulatinho.net/sitemap.xml' />

<meta name="robots" content="index,follow" />
<meta name="googlebot" content="index,follow" />



<meta property="fb:admins" content="" />


<meta name="apple-mobile-web-app-title" content="Alexandre Mulatinho Blog" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black" />






<meta name="generator" content="Hugo 0.140.2">


    
    

<link type="text/css" rel="stylesheet" href="/css/bundle.min.94a339836f89f0d25f31980cb6b0631da21e20af128308747ce44e0525eb16ef.css">


    
    <style>
    body {
        --sidebar-bg-color: #202020;
        --sidebar-img-border-color: #515151;
        --sidebar-p-color: #909090;
        --sidebar-h1-color: #FFF;
        --sidebar-a-color: #FFF;
        --sidebar-socials-color: #FFF;
        --text-color: #222;
        --bkg-color: #FAF9F6;
        --post-title-color: #303030;
        --list-color: #5A5A5A;
        --link-color: #268BD2;
        --date-color: #515151;
        --table-border-color: #E5E5E5;
        --table-stripe-color: #F9F9F9;
        --code-color: #000;
        --code-background-color: #E5E5E5;
        --code-block-color: #FFF;
        --code-block-background-color: #272822;
        --moon-sun-color: #FFF;
        --moon-sun-background-color: #515151;
    }
    body.dark-theme {
        --text-color: #EEE;
        --bkg-color: #121212;
        --post-title-color: #DBE2E9;
        --list-color: #9D9D9D;
        --link-color: #268BD2;
        --date-color: #9A9A9A;
        --table-border-color: #515151;
        --table-stripe-color: #202020;
        --code-color: #FFF;
        --code-background-color: #515151;
        --code-block-color: #FFF;
        --code-block-background-color: #272822;
    }
    body {
        background-color: var(--bkg-color);
    }
</style>

</head>

    <body class="dark-theme">
        <div class="wrapper">
            <aside class="sidebar">
    <div class="container sidebar-sticky">
        <div class="light-dark" align="right">
    <button class="btn-light-dark" title="Toggle light/dark mode">
        <svg class="moon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16">
            <path fill="currentColor" d="M6 .278a.768.768 0 0 1 .08.858a7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277c.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316a.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71C0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"/>
        </svg>
        <svg class="sun" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16">
            <path fill="currentColor" d="M8 12a4 4 0 1 0 0-8a4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/>
        </svg>
    </button>
</div>

        <div class="sidebar-about">
    <h1 class="brand">
        
        
            <a href="https://mulatinho.net/">
                <h1>Alexandre Mulatinho</h1>
            </a>
        
    </h1>
    <p class="lead">
    the home of a Brazilian software engineer
    </p>
</div>

        <center>

    <a target="_blank" class="social" title="GitHub" href="https://github.com/mulatinho">
        <svg xmlns="http://www.w3.org/2000/svg" width="1.2em" height="1.2em" viewBox="-2 -2 24 24">
            <path fill="currentColor" d="M18.88 1.099C18.147.366 17.265 0 16.233 0H3.746C2.714 0 1.832.366 1.099 1.099C.366 1.832 0 2.714 0 3.746v12.487c0 1.032.366 1.914 1.099 2.647c.733.733 1.615 1.099 2.647 1.099H6.66c.19 0 .333-.007.429-.02a.504.504 0 0 0 .286-.169c.095-.1.143-.245.143-.435l-.007-.885c-.004-.564-.006-1.01-.006-1.34l-.3.052c-.19.035-.43.05-.721.046a5.555 5.555 0 0 1-.904-.091a2.026 2.026 0 0 1-.872-.39a1.651 1.651 0 0 1-.572-.8l-.13-.3a3.25 3.25 0 0 0-.41-.663c-.186-.243-.375-.407-.566-.494l-.09-.065a.956.956 0 0 1-.17-.156a.723.723 0 0 1-.117-.182c-.026-.061-.004-.111.065-.15c.07-.04.195-.059.378-.059l.26.04c.173.034.388.138.643.311a2.1 2.1 0 0 1 .631.677c.2.355.44.626.722.813c.282.186.566.28.852.28c.286 0 .533-.022.742-.065a2.59 2.59 0 0 0 .585-.196c.078-.58.29-1.028.637-1.34a8.907 8.907 0 0 1-1.333-.234a5.314 5.314 0 0 1-1.223-.507a3.5 3.5 0 0 1-1.047-.872c-.277-.347-.505-.802-.683-1.365c-.177-.564-.266-1.215-.266-1.952c0-1.049.342-1.942 1.027-2.68c-.32-.788-.29-1.673.091-2.652c.252-.079.625-.02 1.119.175c.494.195.856.362 1.086.5c.23.14.414.257.553.352a9.233 9.233 0 0 1 2.497-.338c.859 0 1.691.113 2.498.338l.494-.312a6.997 6.997 0 0 1 1.197-.572c.46-.174.81-.221 1.054-.143c.39.98.424 1.864.103 2.653c.685.737 1.028 1.63 1.028 2.68c0 .737-.089 1.39-.267 1.957c-.177.568-.407 1.023-.689 1.366a3.65 3.65 0 0 1-1.053.865c-.42.234-.828.403-1.223.507a8.9 8.9 0 0 1-1.333.235c.45.39.676 1.005.676 1.846v3.11c0 .147.021.266.065.357a.36.36 0 0 0 .208.189c.096.034.18.056.254.064c.074.01.18.013.318.013h2.914c1.032 0 1.914-.366 2.647-1.099c.732-.732 1.099-1.615 1.099-2.647V3.746c0-1.032-.367-1.914-1.1-2.647z"/>
        </svg>
    </a>



    <a target="_blank" class="social" title="LinkedIn" href="https://linkedin.com/in/mulatinho">
        <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1.2em" viewBox="0 0 448 512">
            <path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5c0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7c-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5c67.2 0 79.7 44.3 79.7 101.9V416z"/>
        </svg>
    </a>










    <a target="_blank" class="social" title="Facebook" href="https://facebook.com">
        <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1.2em" viewBox="0 0 448 512">
            <path fill="currentColor" d="M400 32H48A48 48 0 0 0 0 80v352a48 48 0 0 0 48 48h137.25V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48c27.14 0 55.52 4.84 55.52 4.84v61h-31.27c-30.81 0-40.42 19.12-40.42 38.73V256h68.78l-11 71.69h-57.78V480H400a48 48 0 0 0 48-48V80a48 48 0 0 0-48-48z"/>
        </svg>
    </a>






    <a target="_blank" class="social" title="RSS Feed" href="/posts/index.xml">
        <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1.2em" viewBox="0 0 1280.000000 1280.000000">
            <g transform="translate(0.000000,1280.000000) scale(0.100000,-0.100000)" fill="currentColor">
                <path d="M2295 11929 c-284 -12 -642 -45 -707 -65 -17 -5 -18 -63 -18 -1039 0 -569 4 -1036 8 -1039 5 -3 74 6 153 19 510 86 1168 95 1789 25 1348 -153 2602 -677 3670 -1531 385 -308 820 -744 1126 -1129 842 -1060 1362 -2313 1514 -3650 70 -621 61 -1279 -25 -1789 -13 -79 -22 -148 -19 -153 3 -4 471 -8 1039 -8 l1035 0 5 23 c51 225 85 942 67 1419 -23 605 -77 1044 -198 1617 -294 1400 -927 2734 -1823 3846 -1043 1295 -2364 2259 -3909 2854 -1158 447 -2451 656 -3707 600z"/>
                <path d="M2255 7845 c-269 -25 -620 -81 -667 -106 -17 -9 -18 -55 -18 -899 0 -706 3 -890 13 -890 6 0 66 18 132 41 130 44 288 79 467 105 154 21 577 30 749 15 1207 -107 2267 -823 2814 -1902 166 -327 268 -637 330 -1001 38 -227 48 -384 42 -662 -8 -348 -44 -590 -126 -831 -23 -66 -41 -126 -41 -132 0 -10 184 -13 890 -13 844 0 890 1 899 18 27 50 88 452 110 725 14 162 14 624 1 782 -59 703 -233 1323 -545 1945 -481 956 -1313 1788 -2270 2268 -620 310 -1239 483 -1940 542 -165 14 -669 10 -840 -5z"/>
                <path d="M2519 3815 c-391 -66 -725 -336 -868 -703 -79 -201 -96 -462 -45 -677 83 -344 338 -641 666 -774 116 -47 205 -69 330 -80 412 -39 811 153 1040 500 193 292 240 648 128 981 -135 403 -492 699 -914 757 -100 14 -241 12 -337 -4z"/>
            </g>
        </svg>
    </a>


    <a target="_blank" class="social" title="Email" href="mailto:alex.mulatinho@yahoo.com">
       <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1.2em" viewBox="0 0 485.211 485.211">
            <path fill="currentColor" d="M301.393,241.631L464.866,424.56H20.332l163.474-182.928l58.801,51.443L301.393,241.631z M462.174,60.651H23.027 l219.579,192.142L462.174,60.651z M324.225,221.67l160.986,180.151V80.792L324.225,221.67z M0,80.792v321.029L160.972,221.64 L0,80.792z"/>
       </svg>
    </a>



</center>

        <nav>
    <ul class="sidebar-nav">

        
        
        
	<center>
        
            

            <h2><a href="/"><b>About</b></a></h2>
        
	<center>
        
            

            <h2><a href="/docs/"><b>Docs</b></a></h2>
        
	<center>
        
            

            <h2><a href="/software/"><b>Softwares</b></a></h2>
        
	<center>
        
            

            <h2><a href="/posts/"><b>Posts</b></a></h2>
        
	</center>
    </ul>
</nav>

        <p class="footnote">
&copy; 2025 Alexandre Mulatinho Blog.<br/>
Powered by <a target="_blank" href="https://gohugo.io">Hugo</a> | themed with <a target="_blank" href="https://github.com/lukeorth/poison">poison</a>
</p>

  </div>
</aside>

            <main class="content container">
                <div class="post">
  <div class="info">
  <h1 class="post-title">
    <a href="https://mulatinho.net/2017/01/27/devops-ansible-basics/">DevOps: Ansible Basics</a>
  </h1>

  <div class="headline">
    <div>
      
        
          <span>mulatinho - </span>
        
      
      
      <time datetime=" 2017-01-27T19:21:01Z" class="post-date">
        January 27, 2017
      </time>
      
      <span> - </span>
      <span class="reading-time">
        
          
        

        <span>5 mins read</span>
      </span>
    </div>

    
  </div>

  
  

  
</div>

  <p><a href="http://docs.ansible.com" target="_blank">Ansible</a> is one of the best tools in DevOps that I like, he just need a simply configuration and can help you with a lot of tasks in your day by day on your infrastructure, today I will show to you how to configure him to work with a lot of servers and how to automate some simple tasks.</p>
<p><strong>Advantages of Ansible</strong></p>
<ul>
<li>Easy to use and fast response</li>
<li>Highly configurable to almost every task you need to do</li>
<li>SSH based, just use <strong>ssh-keygen, ssh-copy-id</strong> and <strong>ssh-add</strong></li>
<li>Free software sponsored by Red Hat</li>
<li>Playbooks to make complex tasks</li>
</ul>
<p><strong>So how we begin use this tool?</strong></p>
<p>The very first thing you need to do is obviously install Ansible on your system. You can do this by typing on linux</p>
<pre tabindex="0"><code># yum install ansible # (redhat)
# apt-get install ansible # (debian/ubuntu)
</code></pre><p>Or on your OSX:</p>
<pre tabindex="0"><code>$ /usr/bin/ruby -e &#34;$(curl -fsSL \
https://raw.githubusercontent.com/Homebrew/install/master/install)&#34;
$ brew install ansible
</code></pre><p><strong>The inventory file</strong></p>
<p>Ansible needs a file to specify all servers you want to control, you can use a tag name to make an group  to all servers you want by category, below we set two groups: <strong>appservers</strong> and <strong>databases</strong>, note that you don&rsquo;t need to specify one by one in a line, you can use regex to simplify (this is awesome!)</p>
<pre tabindex="0"><code>[appservers]
staging1.dev.yourcompany.com
staging2.dev.yourcompany.com
staging3.dev.yourcompany.com

[databases]
db[1:5].dev.yourcompany.com
</code></pre><p>After that, or perhaps before that, as told before Ansible needs a SSH <em>master key</em> that need to be added on <strong>~/.ssh/authorize_keys</strong> file into each of your slave servers, to do that you just need to proceed like this:</p>
<pre tabindex="0"><code>$ ssh-keygen -t rsa # (to generate your key, enter until finish)
</code></pre><p>And you will get a <strong>~/.ssh/id_rsa.pub</strong> public key file in your <strong>$HOME</strong> directory; So now you need to distribute your public-key to all servers you need control, this can be easy if you have only ten servers to administer or a pain if you have to do this in more than 100+ servers, so here&rsquo;s a tip:</p>
<ol>
<li>
<p>Create a file with all your servers like this:</p>
<pre tabindex="0"><code>root@server1.dev.company.com
root@server2.dev.company.com
</code></pre><p>(I will not show to you how to make this with inventory file as input, but you can!)</p>
</li>
<li>
<p>Use this command-line to copy your keys to each server and insert root-password</p>
<pre tabindex="0"><code>$ while read LINE; do ssh-copy-id $LINE; done &lt; /tmp/servers
</code></pre></li>
</ol>
<p><strong>Using Ansible in command-line</strong></p>
<p>All set? So lets try do something really cool here. This is the most basic syntax of ansible:</p>
<p><strong>$ ansible :target: -i inventory-file :actions:</strong></p>
<p>Where <strong>:target:</strong> is the group of servers in your inventory file or just an string <strong>all</strong> to contemplate all servers in your inventory, the <strong>:actions:</strong> can be a simply command like below or a more complex command-line using <em>ansible modules</em>.</p>
<ul>
<li>
<p>Get all kernel versions of our servers</p>
<pre tabindex="0"><code>$ ansible all -i yourcompany.conf -u root -a &#34;uname -a&#34;
staging1.dev.yourcompany.com | SUCCESS | rc=0 &gt;&gt;
Linux staging1.dev 3.13.0-92-generic #139-Ubuntu SMP Tue Jun 28 20:42:26 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux

staging3.dev.yourcompany.com | SUCCESS | rc=0 &gt;&gt;
Linux staging3.dev 3.13.0-92-generic #139-Ubuntu SMP Tue Jun 28 20:42:26 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux

db2.dev.yourcompany.com | SUCCESS | rc=0 &gt;&gt;
Linux db2.dev 3.13.0-92-generic #139-Ubuntu SMP Tue Jun 28 20:42:26 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux

staging2.dev.yourcompany.com | SUCCESS | rc=0 &gt;&gt;
Linux staging2.dev.yourcompany.com 3.13.0-92-generic #139-Ubuntu SMP Tue Jun 28 20:42:26 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux
</code></pre><p>(Note that all servers responded with your kernel)</p>
</li>
<li>
<p>Use a default module <strong>ping</strong> to check if <strong>databases</strong> are alive</p>
<pre tabindex="0"><code>$ ansible databases -i yourcompany.conf -m ping
db1.dev.yourcompany.com | SUCCESS =&gt; {
    &#34;changed&#34;: false,
    &#34;ping&#34;: &#34;pong&#34;
}
db2.dev.yourcompany.com | SUCCESS =&gt; {
    &#34;changed&#34;: false,
    &#34;ping&#34;: &#34;pong&#34;
}
....
</code></pre></li>
<li>
<p>Use a default module <strong>apt</strong> to install a mysql database</p>
<pre tabindex="0"><code>$ ansible databases -i yourcompany.conf \
-m apt -a &#34;name=mysql-server state=latest&#34;
</code></pre></li>
</ul>
<p><strong>So how can I know what modules are available?</strong></p>
<p>They are listed here -&gt; <a href="http://docs.ansible.com/ansible/list_of_all_modules.html" target="_blank">http://docs.ansible.com/ansible/list_of_all_modules.html</a> <strong>Playbooks: The real thing</strong></p>
<p>Okay, now you know that you can send commands and use modules to process in all your servers with just one command line, thats cool! But what really amazing in Ansible are the playbooks! A playbook is just a file with a template engine called <a href="http://yaml.org" target="_blank">YAML</a> and <a href="http://jinja.pocoo.org/docs/2.9/templates/#builtin-filters" target="_blank">Jinja</a> to apply some filters, variables and others, with that you can do a lot of automate complex tasks in your servers. Lets take a look into a sample file called &rsquo; <strong>install_apache.yml</strong>':</p>
<pre tabindex="0"><code>---
- hosts: appservers
  vars:
    http_port: 80
    max_clients: 200
  remote_user: root
  tasks:
  - name: install or upgrade apache to latest version
    yum: name=httpd state=latest
  - name: write the apache config file
    template: src=./httpd.j2 dest=/etc/httpd.conf
    notify:
    - restart apache
  - name: ensure apache is running (and enable it at boot)
    service: name=httpd state=started enabled=yes
  handlers:
    - name: restart apache
      service: name=httpd state=restarted
</code></pre><p>There&rsquo;s a lot of information and process automation here.</p>
<ol>
<li><strong>hosts</strong> -&gt; means that all these tasks will only be executed in the group defined after the word, here <strong>appservers,</strong> defined by our <em>inventory file</em> in the begin of this post.</li>
<li><strong>vars</strong> -&gt; are variables you define to process tasks with it, note that variables are defined line by line.</li>
<li><strong>remote_user</strong>-&gt; another way to use <strong>-u root</strong> without need to put in cmd.</li>
<li><strong>name</strong> -&gt; is just a name you define to implement a task</li>
<li><strong>template</strong> -&gt; in this case is just a way to say, copy my source file defined as . <em>/httpd.j2</em> to destination server on <em>/etc/httpd.conf</em></li>
<li><strong>notify</strong> -&gt; is a tag that call a job ( <strong>restart apache</strong>) in handlers block at the end of execution of the current block</li>
</ol>
<p>Or, to resume this playbook will:</p>
<ol>
<li>Install the latest version of httpd apache on all your <strong>appservers</strong></li>
<li>Copy your local <strong>httpd.j2</strong> file to remote server on <strong>/etc/httpd.conf</strong>
<ol>
<li>Put your variables where you set in <strong>httpd.j2</strong> file</li>
<li>Restart apache after that</li>
</ol>
</li>
<li>Set apache to <em>run automatically</em> after a boot/reboot</li>
</ol>
<p>As you see you can do a lot with this, without this you would need to enter in each server and make these tasks one by one without any human mistake, with ansible you just need to type this:</p>
<p><strong>$ ansible-playbook -i yourcompany.conf install_apache.yml</strong></p>
<p>On next time we will show to you how to do more complex examples, best practices and directory structure to help on your day tasks.</p>
<p>Thats it for now! What are you waiting for? Use ansible to automate your tasks now!! :)</p>

  
  

  
</div>
            </main>
            
  
    <div class="article-toc ">
    <div class="toc-wrapper">
      <h4 id="contents"></h4>
      <nav id="TableOfContents"></nav>
    </div>
</div>

  

        </div>
    </body>
</html>
